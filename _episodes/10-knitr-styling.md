---
title: 'Knitr Syntax: Styling Code Outputs'
teaching: 35
exercises: 5
questions:
- How do I make better styled tables in R Markdown?
- How do I add captions to code generated figures?
- How do I consistently size and align images and figures?
- How do I cross reference figures & tables?
objectives:
- Create better styled tables
- Add captions to code-generated figures, tables, images
- Globally size and align images and figures
- Use cross referencing

keypoints:
- Use kable() to create tables from dataframes
- add captions to figures and images generated by code chunks
- Set global chunk settings to automatically size & align outputs
- Use bookdown to enable cross referencing
source: Rmd
---



## Create better tables in R Markdown

Our markdown table is formatted weirdly. Unfortunately, it isn't possible to style tables created with basic markdown syntax. In order to create a table that is stylable, we need to save it as a dataframe and use a package function to style it. There are MANY packages that allow you to create tables in Rmd. See list (FIXME add list)

### Restyle the table with kable 
We will use kable to recreate our table. `kable()` is a function in the `knitr` package (which we use anyway for rendering our html file). `kable()` creates a basic stylable table. 

1) change table to kable table
  a) load "knitr" & table1 data in first code chunk
  b) delete markdown table 
  c) paste in code to new code chunk (minus the caption)

> ## Note: Other table packages
> Include:
> Even though we can do a bit more styling with `kable()`, it's still pretty basic. To do more complex tables,  `kableExtra` package was developed. This especially allows more control over formatting. There are other multiple other packages as well that help with table formatting `officer`?? for Word and `xtable` are two examples. 
> FIXME add others & links to CRAN
{: .callout}

## Add captions to code-generated tables & plots

Also, we learned how to add captions to images earlier on, but now, how do we add captions to the code-generated plots and the new table we just added? It is a little different between tables and code-generated plots/images.

### Add captions to code-generated plots, figures & images

To add captions for Figure 1 and 3 we're going to go back to our favorite code chunk options. Anytime after defining the code chunk name we can add the option: `fig.cap = `. Notice that the syntax is slightly different than our other options but it has the same `=` . Instead of indicating TRUE/FALSE however, we can type our caption right after the = in quotes `""`. 

1) cut the caption from where it was. Or do we need to supply this again?? FIXME
2) type in fig.cap = ""
3) paste or type in the caption

```
FIXME add code
```

> ## CHALLENGE 10.1 - add a caption for Figure 3  
> Add the caption:  
> `FIGURE 3 - `
>
>> ## SOLUTION  
>> FIXME add code here  
>>
>{: .solution}  
{: .challenge}  


### Add captions to code-generated tables

Ok, now let's do the table. For the table, you can't add the same `fig.cap = ` to the chunk options (of course you can't), but the `kable()` function has an argument called `caption`. So, we can go back to our kable function and add this:

First, cut the orignial table caption from it's spot in the paper
Second, add to the kable function `caption = ` and paste the caption in between `"`s

```
 `caption="Table 1. Major challenges to rigor observed in shared resources"`
```

Should output as so:

    TABLE 1 - Major challenges to rigor observed in shared resources
    

  

## Globally align & size plots/figures

globally size & align pictures.

We added sizes to our images individually in a previous episode. However, instead of changing the sizes one-by one, we can do it within our `knitr::opts_chunk$set` settings in our setup code chunk. 

### Automatically size figures & images


fig.width vs out.width
fig.heigh vs. out.height

fig.width & height ONLY apply to R-generated figures. out.width & height can be used with any type of graphic.

We want to be inclusive of the images in our Rmd file so we will use out.width & out.height.

add (before or after) the options, to the global code chunk:
We previously sized the images to 50% was a bit small anyway, so let's try 60% instead
```
knitr::opts_chunk$set(fig.align = "center", out.width="60%", out.height="60%", echo = FALSE)
```

oh no, Fig 2 isn't aligning. The settings ONLY apply to code chunks, however our Figure 2 is still just a markdown-styled image. 

We will add it to a code chunk instead:

name the code chunk fig-2 and copy and paste the caption between quotes with the `fig.cap=""` option. 
use `include_graphics()` from `knitr` package (alternatively can use syntax `knitr::include_graphics()). Add the file path in quotes. 

```

~~~
include_graphics("../figs/fig2_paper.jpg")
~~~
{: .language-r}
```

### Automatically align code chunk outputs

## Cross-referencing (optional)

from bookdown.org:

Cross-referencing is a useful way of directing your readers through your document, and can be automatically done within R Markdown. While this has been explained in Chapter 2 from the bookdown book, we want to present a brief summary below.

To use cross-references, you will need:

A bookdown output format: Cross-referencing is not provided directly within the base rmarkdown package, but is provided as an extension in bookdown (Xie 2020c). We must therefore use an output format from bookdown (e.g., html_document2, pdf_document2, and word_document2, etc.) in the YAML output field.

A caption to your figure (or table): Figures without a caption will be included directly as images and will therefore not be a numbered figure.

A labeled code chunk: This provides the identifier for referencing the figure generated by the chunk.

After these conditions are met, we can make cross-references within the text using the syntax \@ref(type:label), where label is the chunk label and type is the environment being referenced (e.g. tab, fig, or eqn). An example is provided below:

add to yaml
```
...
ouput:
  bookdown::html_document2:
...
```
  
the rest stays the same.


~~~
library(bookdown)
~~~
{: .language-r}

2 cross-referencing additions. 
See table 1 in strategies section

See figure 2 shortly after

*Note adding crossing referencing re-names the figures, so should take the figure numbering out.



